## [Payload PR - BIP-268](https://github.com/BalancerMaxis/multisig-ops/pull/153)

## Background
The [v3 Weighted Pool Factory](https://github.com/balancer-labs/balancer-v2-monorepo/tree/master/pkg/deployments/tasks/20230206-weighted-pool-v3) and the [v3 Composable Stable Pool Factory](https://github.com/balancer-labs/balancer-v2-monorepo/tree/master/pkg/deployments/tasks//20230206-composable-stable-pool-v3) where deployed to fix reentrancy issue described [here](https://forum.balancer.fi/t/reentrancy-vulnerability-scope-expanded/4345).  Some initial "wire-up" of permissions is required to bring them into standard function.  This BIP lays out these changes and requests permission to apply them.

## English Specification

The transaction details were generated by [this script](https://github.com/BalancerMaxis/multisig-ops/blob/main/tools/python/gen_add_permissions_payload.py) with inputs and outputs in [this directory](https://github.com/BalancerMaxis/multisig-ops/tree/staging/BIPs/BIP-268)

The following files can be found both linked below and in the payload PR linked above:

| Filename                                                                                                                             | Description of Contents                                                                                                              |
|--------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| [inputs.json](https://github.com/BalancerMaxis/multisig-ops/blob/staging/BIPs/BIP-268/inputs.json)                                   | The inputs to the script mapping functions and deployments to target addresses that can execute them.                                |
| [results_address_sorted.md](https://github.com/BalancerMaxis/multisig-ops/blob/staging/BIPs/BIP-268/results_address_sorted.md)       | The resulting changes printed in a table sorted by target chain and target address. (to easily understand permisisons granted)       |
| [results_deployment_sorted.md](https://github.com/BalancerMaxis/multisig-ops/blob/staging/BIPs/BIP-268/results_deployment_sorted.md) | The resulting changes printed in a table sorted by target chain and target deployment. (for verification against action ids)         |
| [function_descriptions.md](https://github.com/BalancerMaxis/multisig-ops/blob/staging/BIPs/BIP-268/function_descriptions.md)         | A table that describes what each function that is being granted privileged access to allows.                                         |                                                                                                                                             |
| [`chainname`.json](https://github.com/BalancerMaxis/multisig-ops/tree/staging/BIPs/BIP-268/)                                         | For each change with changes, a transaction builder json named after said chain exists to apply the changes described in the tables. |

In the tables above:

The "emergency" caller group:
 - maps to the Balancer Emergency DAO Multisig as defined in [this vote](https://forum.balancer.fi/t/form-the-emergency-subdao/3197).

The "feeManager" caller group:
 - maps to the feeManager multisig controlled by the Balancer Maxis on all chains except mainnet.
 - On mainnet a special feeSetter multisig exists to manage a-factors and a gautletFeeSetter contract that allows bulk changing of fees.  
 - The maxi's functionally control all contracts that make up the feeManager target group.

_More information about the various Balancer Multisigs and their functions can be found in the [multisig-ops repo](https://github.com/BalancerMaxis/multisig-ops/blob/staging/multisigs.md)_
# Specification

As described in the payload json, the authorizer will be called to grant the roles as described.  

The change can be reviewed by the below by comparing the [results_deployment_sorted.md](https://github.com/BalancerMaxis/multisig-ops/tree/staging/BIPs/BIP-183/results_deployment_sorted.md) file to the source of truth,  which should match the order found in the source of truth for actionIds on the [balancer-v2-monorepo](https://github.com/balancer-labs/balancer-v2-monorepo/tree/master/pkg/deployments/action-ids).

For record, the contents of [results_address_sorted.md](https://github.com/BalancerMaxis/multisig-ops/tree/staging/BIPs/BIP-268/results_address_sorted.md) are printed here:



| deployment                            | chain    | function                    | role                                                               | target   | target_address                             |
|:--------------------------------------|:---------|:----------------------------|:-------------------------------------------------------------------|:---------|:-------------------------------------------|
| 20230316-child-chain-gauge-factory-v2 | arbitrum | add_reward(address,address) | 0x56245c361d1ed9e55e6f9889e49f36d9991761b712de544f847b557a84ccd62f | lm       | 0xc38c5f97B34E175FFd35407fc91a937300E33860 |
| 20230316-child-chain-gauge-factory-v2 | gnosis   | add_reward(address,address) | 0xc94195da697c94d4db5c313ab49b9ea64c8d69137624b163ba0e4540edfd0faf | lm       | 0x14969B55a675d13a1700F71A37511bc22D90155a |
| 20230316-child-chain-gauge-factory-v2 | optimism | add_reward(address,address) | 0x3bf29175652a3f0fac5abb715d0b7fe2e7b597e2e2eff555dac6b21a20a7c83e | lm       | 0x09Df1626110803C7b3b07085Ef1E053494155089 |
| 20230316-child-chain-gauge-factory-v2 | polygon  | add_reward(address,address) | 0x728b7c90958572ff4fc88088c34b65ed64230c82afe8611d4d44d39d0845c264 | lm       | 0xc38c5f97B34E175FFd35407fc91a937300E33860 |
## Risk Assessment
This BIP is routine operation for provisioning a new factory.  The new factories are themselves a risk mitigation.


## References

[Directory of Addresses used by script which generated the table and multsig payloads](https://github.com/BalancerMaxis/multisig-ops/blob/main/tools/python/brownie/helpers/addresses.py)

