## [Payload PR - BIP-216](https://github.com/BalancerMaxis/multisig-ops/pull/113)

## Background
The [v3 Weighted Pool Factory](https://github.com/balancer-labs/balancer-v2-monorepo/tree/master/pkg/deployments/tasks/20230206-weighted-pool-v3) and the [v3 Composable Stable Pool Factory](https://github.com/balancer-labs/balancer-v2-monorepo/tree/master/pkg/deployments/tasks//20230206-composable-stable-pool-v3) where deployed to fix reentrancy issue described [here](https://forum.balancer.fi/t/reentrancy-vulnerability-scope-expanded/4345).  Some initial "wire-up" of permissions is required to bring them into standard function.  This BIP lays out these changes and requests permission to apply them.

## English Specification

The transaction details were generated by [this script](https://github.com/BalancerMaxis/multisig-ops/blob/main/tools/python/gen_add_permissions_payload.py) with inputs and outputs in [this directory](https://github.com/BalancerMaxis/multisig-ops/tree/staging/BIPs/BIP-216)

The following files can be found both linked below and in the payload PR linked above:

| Filename                                                                                                                             | Description of Contents                                                                                                              |
|--------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| [inputs.json](https://github.com/BalancerMaxis/multisig-ops/blob/staging/BIPs/BIP-216/inputs.json)                                   | The inputs to the script mapping functions and deployments to target addresses that can execute them.                                |
| [results_address_sorted.md](https://github.com/BalancerMaxis/multisig-ops/blob/staging/BIPs/BIP-216/results_address_sorted.md)       | The resulting changes printed in a table sorted by target chain and target address. (to easily understand permisisons granted)       |
| [results_deployment_sorted.md](https://github.com/BalancerMaxis/multisig-ops/blob/staging/BIPs/BIP-216/results_deployment_sorted.md) | The resulting changes printed in a table sorted by target chain and target deployment. (for verification against action ids)         |
| [function_descriptions.md](https://github.com/BalancerMaxis/multisig-ops/blob/staging/BIPs/BIP-216/function_descriptions.md)         | A table that describes what each function that is being granted privileged access to allows.                                         |                                                                                                                                             |
| [`chainname`.json](https://github.com/BalancerMaxis/multisig-ops/tree/staging/BIPs/BIP-216/)                                         | For each change with changes, a transaction builder json named after said chain exists to apply the changes described in the tables. |

In the tables above:

The "emergency" caller group:
 - maps to the Balancer Emergency DAO Multisig as defined in [this vote](https://forum.balancer.fi/t/form-the-emergency-subdao/3197).

The "feeManager" caller group:
 - maps to the feeManager multisig controlled by the Balancer Maxis on all chains except mainnet.
 - On mainnet a special feeSetter multisig exists to manage a-factors and a gautletFeeSetter contract that allows bulk changing of fees.  
 - The maxi's functionally control all contracts that make up the feeManager target group.

_More information about the various Balancer Multisigs and their functions can be found in the [multisig-ops repo](https://github.com/BalancerMaxis/multisig-ops/blob/staging/multisigs.md)_
# Specification

As described in the payload json, the authorizer will be called to grant the roles as described.  

The change can be reviewed by the below by comparing the [results_deployment_sorted.md](https://github.com/BalancerMaxis/multisig-ops/tree/staging/BIPs/BIP-183/results_deployment_sorted.md) file to the source of truth,  which should match the order found in the source of truth for actionIds on the [balancer-v2-monorepo](https://github.com/balancer-labs/balancer-v2-monorepo/tree/master/pkg/deployments/action-ids).

For record, the contents of [results_address_sorted.md](https://github.com/BalancerMaxis/multisig-ops/tree/staging/BIPs/BIP-216/results_address_sorted.md) are printed here:



| deployment     | chain    | function                                                                                                          | role                                                               | target                                    | target_address                             |
|:---------------|:---------|:------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------|:------------------------------------------|:-------------------------------------------|
| 20210418-vault | arbitrum | batchSwap(uint8,(bytes32,uint256,uint256,uint256,bytes)[],address[],(address,bool,address,bool),int256[],uint256) | 0x1282ab709b2b70070f829c46bc36f76b32ad4989fecb2fcb09a1b3ce00bbfc30 | 20230314-batch-relayer-v5/BalancerRelayer | 0x598ce0f1ab64B27256759ef99d883EE51138b9bd |
| 20210418-vault | arbitrum | exitPool(bytes32,address,address,(address[],uint256[],bytes,bool))                                                | 0xc149e88b59429ded7f601ab52ecd62331cac006ae07c16543439ed138dcb8d34 | 20230314-batch-relayer-v5/BalancerRelayer | 0x598ce0f1ab64B27256759ef99d883EE51138b9bd |
| 20210418-vault | arbitrum | joinPool(bytes32,address,address,(address[],uint256[],bytes,bool))                                                | 0x78ad1b68d148c070372f8643c4648efbb63c6a8a338f3c24714868e791367653 | 20230314-batch-relayer-v5/BalancerRelayer | 0x598ce0f1ab64B27256759ef99d883EE51138b9bd |
| 20210418-vault | arbitrum | manageUserBalance((uint8,address,uint256,address,address)[])                                                      | 0xeba777d811cd36c06d540d7ff2ed18ed042fd67bbf7c9afcf88c818c7ee6b498 | 20230314-batch-relayer-v5/BalancerRelayer | 0x598ce0f1ab64B27256759ef99d883EE51138b9bd |
| 20210418-vault | arbitrum | setRelayerApproval(address,address,bool)                                                                          | 0x0014a06d322ff07fcc02b12f93eb77bb76e28cdee4fc0670b9dec98d24bbfec8 | 20230314-batch-relayer-v5/BalancerRelayer | 0x598ce0f1ab64B27256759ef99d883EE51138b9bd |
| 20210418-vault | arbitrum | swap((bytes32,uint8,address,address,uint256,bytes),(address,bool,address,bool),uint256,uint256)                   | 0x7b8a1d293670124924a0f532213753b89db10bde737249d4540e9a03657d1aff | 20230314-batch-relayer-v5/BalancerRelayer | 0x598ce0f1ab64B27256759ef99d883EE51138b9bd |
| 20210418-vault | gnosis   | batchSwap(uint8,(bytes32,uint256,uint256,uint256,bytes)[],address[],(address,bool,address,bool),int256[],uint256) | 0x1282ab709b2b70070f829c46bc36f76b32ad4989fecb2fcb09a1b3ce00bbfc30 | 20230314-batch-relayer-v5/BalancerRelayer | 0x3536fD480CA495Ac91E698A703248A8915c137a3 |
| 20210418-vault | gnosis   | exitPool(bytes32,address,address,(address[],uint256[],bytes,bool))                                                | 0xc149e88b59429ded7f601ab52ecd62331cac006ae07c16543439ed138dcb8d34 | 20230314-batch-relayer-v5/BalancerRelayer | 0x3536fD480CA495Ac91E698A703248A8915c137a3 |
| 20210418-vault | gnosis   | joinPool(bytes32,address,address,(address[],uint256[],bytes,bool))                                                | 0x78ad1b68d148c070372f8643c4648efbb63c6a8a338f3c24714868e791367653 | 20230314-batch-relayer-v5/BalancerRelayer | 0x3536fD480CA495Ac91E698A703248A8915c137a3 |
| 20210418-vault | gnosis   | manageUserBalance((uint8,address,uint256,address,address)[])                                                      | 0xeba777d811cd36c06d540d7ff2ed18ed042fd67bbf7c9afcf88c818c7ee6b498 | 20230314-batch-relayer-v5/BalancerRelayer | 0x3536fD480CA495Ac91E698A703248A8915c137a3 |
| 20210418-vault | gnosis   | setRelayerApproval(address,address,bool)                                                                          | 0x0014a06d322ff07fcc02b12f93eb77bb76e28cdee4fc0670b9dec98d24bbfec8 | 20230314-batch-relayer-v5/BalancerRelayer | 0x3536fD480CA495Ac91E698A703248A8915c137a3 |
| 20210418-vault | gnosis   | swap((bytes32,uint8,address,address,uint256,bytes),(address,bool,address,bool),uint256,uint256)                   | 0x7b8a1d293670124924a0f532213753b89db10bde737249d4540e9a03657d1aff | 20230314-batch-relayer-v5/BalancerRelayer | 0x3536fD480CA495Ac91E698A703248A8915c137a3 |
| 20210418-vault | mainnet  | batchSwap(uint8,(bytes32,uint256,uint256,uint256,bytes)[],address[],(address,bool,address,bool),int256[],uint256) | 0x1282ab709b2b70070f829c46bc36f76b32ad4989fecb2fcb09a1b3ce00bbfc30 | 20230314-batch-relayer-v5/BalancerRelayer | 0xfeA793Aa415061C483D2390414275AD314B3F621 |
| 20210418-vault | mainnet  | exitPool(bytes32,address,address,(address[],uint256[],bytes,bool))                                                | 0xc149e88b59429ded7f601ab52ecd62331cac006ae07c16543439ed138dcb8d34 | 20230314-batch-relayer-v5/BalancerRelayer | 0xfeA793Aa415061C483D2390414275AD314B3F621 |
| 20210418-vault | mainnet  | joinPool(bytes32,address,address,(address[],uint256[],bytes,bool))                                                | 0x78ad1b68d148c070372f8643c4648efbb63c6a8a338f3c24714868e791367653 | 20230314-batch-relayer-v5/BalancerRelayer | 0xfeA793Aa415061C483D2390414275AD314B3F621 |
| 20210418-vault | mainnet  | manageUserBalance((uint8,address,uint256,address,address)[])                                                      | 0xeba777d811cd36c06d540d7ff2ed18ed042fd67bbf7c9afcf88c818c7ee6b498 | 20230314-batch-relayer-v5/BalancerRelayer | 0xfeA793Aa415061C483D2390414275AD314B3F621 |
| 20210418-vault | mainnet  | setRelayerApproval(address,address,bool)                                                                          | 0x0014a06d322ff07fcc02b12f93eb77bb76e28cdee4fc0670b9dec98d24bbfec8 | 20230314-batch-relayer-v5/BalancerRelayer | 0xfeA793Aa415061C483D2390414275AD314B3F621 |
| 20210418-vault | mainnet  | swap((bytes32,uint8,address,address,uint256,bytes),(address,bool,address,bool),uint256,uint256)                   | 0x7b8a1d293670124924a0f532213753b89db10bde737249d4540e9a03657d1aff | 20230314-batch-relayer-v5/BalancerRelayer | 0xfeA793Aa415061C483D2390414275AD314B3F621 |
| 20210418-vault | optimism | batchSwap(uint8,(bytes32,uint256,uint256,uint256,bytes)[],address[],(address,bool,address,bool),int256[],uint256) | 0x1282ab709b2b70070f829c46bc36f76b32ad4989fecb2fcb09a1b3ce00bbfc30 | 20230314-batch-relayer-v5/BalancerRelayer | 0x03F1ab8b19bcE21EB06C364aEc9e40322572a1e9 |
| 20210418-vault | optimism | exitPool(bytes32,address,address,(address[],uint256[],bytes,bool))                                                | 0xc149e88b59429ded7f601ab52ecd62331cac006ae07c16543439ed138dcb8d34 | 20230314-batch-relayer-v5/BalancerRelayer | 0x03F1ab8b19bcE21EB06C364aEc9e40322572a1e9 |
| 20210418-vault | optimism | joinPool(bytes32,address,address,(address[],uint256[],bytes,bool))                                                | 0x78ad1b68d148c070372f8643c4648efbb63c6a8a338f3c24714868e791367653 | 20230314-batch-relayer-v5/BalancerRelayer | 0x03F1ab8b19bcE21EB06C364aEc9e40322572a1e9 |
| 20210418-vault | optimism | manageUserBalance((uint8,address,uint256,address,address)[])                                                      | 0xeba777d811cd36c06d540d7ff2ed18ed042fd67bbf7c9afcf88c818c7ee6b498 | 20230314-batch-relayer-v5/BalancerRelayer | 0x03F1ab8b19bcE21EB06C364aEc9e40322572a1e9 |
| 20210418-vault | optimism | setRelayerApproval(address,address,bool)                                                                          | 0x0014a06d322ff07fcc02b12f93eb77bb76e28cdee4fc0670b9dec98d24bbfec8 | 20230314-batch-relayer-v5/BalancerRelayer | 0x03F1ab8b19bcE21EB06C364aEc9e40322572a1e9 |
| 20210418-vault | optimism | swap((bytes32,uint8,address,address,uint256,bytes),(address,bool,address,bool),uint256,uint256)                   | 0x7b8a1d293670124924a0f532213753b89db10bde737249d4540e9a03657d1aff | 20230314-batch-relayer-v5/BalancerRelayer | 0x03F1ab8b19bcE21EB06C364aEc9e40322572a1e9 |
| 20210418-vault | polygon  | batchSwap(uint8,(bytes32,uint256,uint256,uint256,bytes)[],address[],(address,bool,address,bool),int256[],uint256) | 0x1282ab709b2b70070f829c46bc36f76b32ad4989fecb2fcb09a1b3ce00bbfc30 | 20230314-batch-relayer-v5/BalancerRelayer | 0xd18d5D377eb23362e54Fa496597d7E962d56C554 |
| 20210418-vault | polygon  | exitPool(bytes32,address,address,(address[],uint256[],bytes,bool))                                                | 0xc149e88b59429ded7f601ab52ecd62331cac006ae07c16543439ed138dcb8d34 | 20230314-batch-relayer-v5/BalancerRelayer | 0xd18d5D377eb23362e54Fa496597d7E962d56C554 |
| 20210418-vault | polygon  | joinPool(bytes32,address,address,(address[],uint256[],bytes,bool))                                                | 0x78ad1b68d148c070372f8643c4648efbb63c6a8a338f3c24714868e791367653 | 20230314-batch-relayer-v5/BalancerRelayer | 0xd18d5D377eb23362e54Fa496597d7E962d56C554 |
| 20210418-vault | polygon  | manageUserBalance((uint8,address,uint256,address,address)[])                                                      | 0xeba777d811cd36c06d540d7ff2ed18ed042fd67bbf7c9afcf88c818c7ee6b498 | 20230314-batch-relayer-v5/BalancerRelayer | 0xd18d5D377eb23362e54Fa496597d7E962d56C554 |
| 20210418-vault | polygon  | setRelayerApproval(address,address,bool)                                                                          | 0x0014a06d322ff07fcc02b12f93eb77bb76e28cdee4fc0670b9dec98d24bbfec8 | 20230314-batch-relayer-v5/BalancerRelayer | 0xd18d5D377eb23362e54Fa496597d7E962d56C554 |
| 20210418-vault | polygon  | swap((bytes32,uint8,address,address,uint256,bytes),(address,bool,address,bool),uint256,uint256)                   | 0x7b8a1d293670124924a0f532213753b89db10bde737249d4540e9a03657d1aff | 20230314-batch-relayer-v5/BalancerRelayer | 0xd18d5D377eb23362e54Fa496597d7E962d56C554 |
## Risk Assessment
This BIP is routine operation for provisioning a new factory.  The new factories are themselves a risk mitigation.


## References

[Directory of Addresses used by script which generated the table and multsig payloads](https://github.com/BalancerMaxis/multisig-ops/blob/main/tools/python/brownie/helpers/addresses.py)

